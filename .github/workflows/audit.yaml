name: audit

on:
  workflow_dispatch

jobs:
  audit-lighthouse:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Run Lighthouse Audit
        run: |-
          docker run --rm \
            --user root \
            --env LIGHTHOUSE_BADGES_PARAMS="--preset=desktop" \
            --volume ${{ github.workspace }}/test_results:/home/chrome/reports:rw \
            emazzotta/lighthouse-badges:6014050 \
            /bin/sh -c "lighthouse-badges --save-report --urls https://rahil-p.com --badge-style flat"
      - name: Upload Badges
        uses: actions/upload-artifact@v3
        with:
          name: lighthouse-badges
          path: ${{ github.workspace }}/test_results
